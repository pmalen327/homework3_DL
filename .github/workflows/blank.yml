name: HW03

on:
  workflow_dispatch:
  push:
    branches: [ main ]
  pull_request:

jobs:
  run-notebook:
    runs-on: ubuntu-latest

    steps:
      # ------------------------------------
      # 1. Checkout your repository
      # ------------------------------------
      - name: Checkout repository
        uses: actions/checkout@v4

      # ------------------------------------
      # 2. Set up Python
      # ------------------------------------
      - name: Set up Python 3.10
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # ------------------------------------
      # 3. Install dependencies
      # ------------------------------------
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu
          pip install kagglehub pandas matplotlib scikit-learn nbconvert jupyter nbformat reportlab seaborn tqdm

      # ------------------------------------
      # 4. Execute Jupyter notebook
      # ------------------------------------
      - name: Run hw03.ipynb
        run: |
          jupyter nbconvert --to notebook \
            --execute hw03.ipynb \
            --output hw03_executed.ipynb \
            --ExecutePreprocessor.timeout=-1

      # ------------------------------------
      # 5. Convert executed notebook to PDF
      # ------------------------------------
      - name: Convert executed notebook to PDF
        run: |
          jupyter nbconvert --to pdf hw03_executed.ipynb --output hw03_output.pdf

      # ------------------------------------
      # 6. Upload the PDF as an artifact
      # ------------------------------------
      - name: Upload rendered PDF
        uses: actions/upload-artifact@v4
        with:
          name: hw03_results_pdf
          path: hw03_output.pdf

      # ------------------------------------
      # 7. (Optional) Upload executed notebook
      # ------------------------------------
      - name: Upload executed notebook
        uses: actions/upload-artifact@v4
        with:
          name: hw03_executed_notebook
          path: hw03_executed.ipynb
